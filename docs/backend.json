{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the CampusConnect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., 'student', 'teacher').",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the user."
        },
        "collegeId": {
          "type": "string",
          "description": "The college ID of the user. Only applicable to students."
        }
      },
      "required": [
        "id",
        "role",
        "email",
        "fullName"
      ]
    },
    "Class": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Class",
      "type": "object",
      "description": "Represents a class in the CampusConnect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the class entity."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:N Class)"
        },
        "classCode": {
          "type": "string",
          "description": "The class code for student registration."
        },
        "name": {
          "type": "string",
          "description": "The name of the class."
        },
        "studentIds": {
          "type": "array",
          "description": "References to Students in this Class. (Relationship: Class 1:N Student)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "teacherId",
        "classCode",
        "name"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Represents an assignment in the CampusConnect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the assignment entity."
        },
        "classId": {
          "type": "string",
          "description": "Reference to Class. (Relationship: Class 1:N Assignment)"
        },
        "title": {
          "type": "string",
          "description": "The title of the assignment."
        },
        "description": {
          "type": "string",
          "description": "The description of the assignment."
        },
        "deadline": {
          "type": "string",
          "description": "The deadline for the assignment.",
          "format": "date-time"
        },
        "mode": {
          "type": "string",
          "description": "The mode of submission (e.g., 'online', 'offline')."
        }
      },
      "required": [
        "id",
        "classId",
        "title",
        "description",
        "deadline",
        "mode"
      ]
    },
    "Submission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Submission",
      "type": "object",
      "description": "Represents a student's submission for an assignment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the submission entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Submission)"
        },
        "assignmentId": {
          "type": "string",
          "description": "Reference to Assignment. (Relationship: Assignment 1:N Submission)"
        },
        "submissionDate": {
          "type": "string",
          "description": "The date and time of the submission.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The content of the submission (e.g., file URL, text)."
        }
      },
      "required": [
        "id",
        "studentId",
        "assignmentId",
        "submissionDate",
        "content"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents student attendance records.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attendance record."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Attendance)"
        },
        "classId": {
          "type": "string",
          "description": "Reference to Class. (Relationship: Class 1:N Attendance)"
        },
        "date": {
          "type": "string",
          "description": "The date of the attendance record.",
          "format": "date-time"
        },
        "isPresent": {
          "type": "boolean",
          "description": "Indicates whether the student was present (true) or absent (false)."
        }
      },
      "required": [
        "id",
        "studentId",
        "classId",
        "date",
        "isPresent"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification sent to students.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification."
        },
        "classId": {
          "type": "string",
          "description": "Reference to Class. (Relationship: Class 1:N Notification)"
        },
        "message": {
          "type": "string",
          "description": "The content of the notification."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the notification was sent.",
          "format": "date-time"
        },
        "studentIds": {
          "type": "array",
          "description": "References to Students who received the notification.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "classId",
        "message",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Path-based ownership ensures only the user can access their own data. Includes the user's role.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/classes/{classId}",
        "definition": {
          "entityName": "Class",
          "schema": {
            "$ref": "#/backend/entities/Class"
          },
          "description": "Stores class data. Each class document includes the teacherId indicating ownership. studentIds are stored as an array within the document. This allows listing classes and filtering on teacherId.",
          "params": [
            {
              "name": "classId",
              "description": "The unique identifier for the class."
            }
          ]
        }
      },
      {
        "path": "/classes/{classId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Stores assignments for each class. Subcollection enables easy retrieval of all assignments for a specific class.",
          "params": [
            {
              "name": "classId",
              "description": "The unique identifier for the class."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier for the assignment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/submissions/{submissionId}",
        "definition": {
          "entityName": "Submission",
          "schema": {
            "$ref": "#/backend/entities/Submission"
          },
          "description": "Stores submissions for each student. Path-based ownership ensures submissions are private to the student.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "submissionId",
              "description": "The unique identifier for the submission."
            }
          ]
        }
      },
      {
        "path": "/classes/{classId}/attendance/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records for each class. Subcollection enables efficient retrieval of attendance records for a specific class.",
          "params": [
            {
              "name": "classId",
              "description": "The unique identifier for the class."
            },
            {
              "name": "attendanceId",
              "description": "The unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/classes/{classId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for each class. Subcollection allows easy access to notifications relevant to a specific class. studentIds array indicates which students the notification was sent to.",
          "params": [
            {
              "name": "classId",
              "description": "The unique identifier for the class."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to reflect the relationships between users, classes, assignments, submissions, attendance, and notifications in the CampusConnect application. The structure uses path-based ownership for private user data and subcollections to represent one-to-many relationships, which simplifies security rules and ensures data integrity.\n\n*   `/users/{userId}`: Stores user data. Using path-based ownership ensures only the user can access their own data. Includes the user's role.\n*   `/classes/{classId}`: Stores class data. Each class document includes the `teacherId` indicating ownership. `studentIds` are stored as an array within the document. This allows listing classes and filtering on `teacherId`.\n*   `/classes/{classId}/assignments/{assignmentId}`: Stores assignments for each class. Subcollection enables easy retrieval of all assignments for a specific class.\n*   `/users/{userId}/submissions/{submissionId}`: Stores submissions for each student. Path-based ownership ensures submissions are private to the student.\n*   `/classes/{classId}/attendance/{attendanceId}`: Stores attendance records for each class. Subcollection enables efficient retrieval of attendance records for a specific class.\n*   `/classes/{classId}/notifications/{notificationId}`: Stores notifications for each class. Subcollection allows easy access to notifications relevant to a specific class. `studentIds` array indicates which students the notification was sent to.\n\n**Authorization Independence:** The design achieves authorization independence primarily through path-based ownership for user-specific data (e.g., `/users/{userId}/submissions/{submissionId}`).  This eliminates the need for `get()` calls to verify ownership. For collaborative data (e.g., access to a Class), the `teacherId` field in the `/classes/{classId}` document serves as the owner. Students are associated to a class via the `studentIds` array in the `/classes/{classId}` document.\n\n**QAPs (Rules are not Filters):**\n*   The segregation of data into collections and subcollections based on entity type (e.g., classes, assignments, submissions) allows for targeted security rules.  Listing operations are secured by limiting access based on the user's role and the relationships between entities. For example, a student can only list submissions under their user ID. A teacher can list assignments under the classes they teach (using the class's teacherId).\n*   The use of a `studentIds` array within the Class document facilitates secure listing of Classes based on student membership."
  }
}